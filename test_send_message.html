<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Message Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-container {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .input-wrapper {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>üîß Send Message Button Test</h1>
    
    <div class="test-container">
        <h2>Connection Status</h2>
        <div id="status" class="status disconnected">
            ‚ùå Not Connected
        </div>
    </div>
    
    <div class="test-container">
        <h2>Send Message Test</h2>
        <div class="input-wrapper">
            <input type="text" id="test-input" placeholder="Type a test message..." value="Hello, this is a test message">
            <button onclick="testSendMessage()">Send Test Message</button>
        </div>
        <button onclick="testGlobalFunction()">Test Global sendMessage()</button>
        <button onclick="testChatAppDirect()">Test ChatApp Direct</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-container">
        <h2>Debug Log</h2>
        <div id="log" class="log">Waiting for tests...\n</div>
    </div>

    <!-- Include Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script>
        let testSocket = null;
        let isConnected = false;
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus(connected) {
            const statusElement = document.getElementById('status');
            isConnected = connected;
            if (connected) {
                statusElement.textContent = '‚úÖ Connected to Server';
                statusElement.className = 'status connected';
            } else {
                statusElement.textContent = '‚ùå Not Connected';
                statusElement.className = 'status disconnected';
            }
        }
        
        function initTestSocket() {
            log('üîÑ Initializing test socket...');
            testSocket = io();
            
            testSocket.on('connect', () => {
                log('‚úÖ Test socket connected successfully');
                updateStatus(true);
            });
            
            testSocket.on('disconnect', () => {
                log('‚ùå Test socket disconnected');
                updateStatus(false);
            });
            
            testSocket.on('connect_error', (error) => {
                log('‚ùå Test socket connection error: ' + error);
                updateStatus(false);
            });
            
            testSocket.on('bot_message', (data) => {
                log('üì® Received bot message: ' + data.message);
            });
        }
        
        function testSendMessage() {
            const input = document.getElementById('test-input');
            const message = input.value.trim();
            
            log('üß™ Testing send message with: "' + message + '"');
            
            if (!message) {
                log('‚ùå No message to send');
                return;
            }
            
            if (!isConnected) {
                log('‚ùå Not connected to server');
                return;
            }
            
            try {
                log('üöÄ Emitting user_message event...');
                testSocket.emit('user_message', { message: message });
                log('‚úÖ Message emitted successfully');
                input.value = '';
            } catch (error) {
                log('‚ùå Error emitting message: ' + error);
            }
        }
        
        function testGlobalFunction() {
            log('üß™ Testing global sendMessage() function...');
            
            if (typeof sendMessage === 'function') {
                log('‚úÖ Global sendMessage function exists');
                try {
                    sendMessage();
                    log('‚úÖ Global sendMessage called successfully');
                } catch (error) {
                    log('‚ùå Error calling global sendMessage: ' + error);
                }
            } else {
                log('‚ùå Global sendMessage function not found');
            }
        }
        
        function testChatAppDirect() {
            log('üß™ Testing ChatApp direct access...');
            
            if (window.chatApp) {
                log('‚úÖ window.chatApp exists');
                log('üîç ChatApp connected: ' + window.chatApp.isConnected);
                log('üîç ChatApp socket: ' + !!window.chatApp.socket);
                
                if (window.chatApp.messageInput) {
                    log('‚úÖ ChatApp messageInput exists');
                    const testMessage = 'Direct ChatApp test message';
                    window.chatApp.messageInput.value = testMessage;
                    
                    try {
                        window.chatApp.sendMessage();
                        log('‚úÖ ChatApp.sendMessage() called successfully');
                    } catch (error) {
                        log('‚ùå Error calling ChatApp.sendMessage(): ' + error);
                    }
                } else {
                    log('‚ùå ChatApp messageInput not found');
                }
            } else {
                log('‚ùå window.chatApp not found');
            }
        }
        
        function clearLog() {
            document.getElementById('log').textContent = 'Log cleared...\n';
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Test page loaded, initializing...');
            initTestSocket();
        });
        
        // Test keyboard events
        document.getElementById('test-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                testSendMessage();
            }
        });
    </script>
</body>
</html>
